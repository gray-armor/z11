<?xml version="1.0" encoding="UTF-8"?>
<protocol name="z11">
  <copyright>TBD</copyright>

  <interface name="z11_compositor" version="1">
    <description summary="core global object for 3D client">TBD</description>

    <request name="create_virtual_object">
      <description summary="create new virtual object">TBD</description>
      <arg name="id" type="new_id" interface="z11_virtual_object" summary="the new virtual object"/>
    </request>
  </interface>

  <interface name="z11_virtual_object" version="1">
    <description summary="https://github.com/gray-armor/z11/wiki/interface:-z11_virtual_object"/>

    <request name="destroy" type="destructor">
      <description summary="destroy virtual object">TBD</description>
    </request>

    <enum name="error">
      <entry name="defunct_component" value="0" summary="virtual object was destroyed before it's components"/>
    </enum>

    <request name="commit">
      <description summary="commit pending virtual object state">
        A commit request atomically applies all pending state, replacing the
        current state.

        All requests that need a commit to become effective are documented to
        affect double-buffered state

        Other interfaces may add further double-buffered surface state.
      </description>
    </request>

    <request name="frame">
      <description summary="request a frame throttling hint">TBD</description>
      <arg name="callback" type="new_id" interface="wl_callback" summary="callback object for the frame request"/>
    </request>
  </interface>

  <interface name="z11_seat" version="1">
    <description summary="group of input devices">TBD</description>

    <enum name="capability" bitfield="true">
      <description summary="seat capability bitmask">TBD</description>
      <entry name="ray" value="1" summary="the seat has ray devices"/>
      <entry name="keyboard" value="2" summary="the seat has one or more keyboards"/>
    </enum>

    <event name="capability">
      <description summary="seat capabilities changed">TBD</description>
      <arg name="capabilities" type="uint" enum="capablility" summary="capabilities of the seat"/>
    </event>

    <request name="get_ray">
      <description summary="return ray object">TBD</description>
      <arg name="id" type="new_id" interface="z11_ray" summary="seat ray"/>
    </request>

    <request name="get_keyboard">
      <description summary="return keyboard object">TBD</description>
      <arg name="id" type="new_id" interface="z11_keyboard" summary="seat keyboard"/>
    </request>
  </interface>

  <interface name="z11_ray" version="1">
    <description summary="ray input device">TBD</description>

    <event name="enter">
      <description summary="enter event">TBD</description>
      <arg name="serial" type="uint" summary="serial number of the enter event"/>
      <arg name="cuboid_window" type="object" interface="z11_cuboid_window"/>
      <arg name="ray_origin_x" type="fixed" summary="ray-origin local x coordinate"/>
      <arg name="ray_origin_y" type="fixed" summary="ray-origin local y coordinate"/>
      <arg name="ray_origin_z" type="fixed" summary="ray-origin local z coordinate"/>
      <arg name="ray_direction_x" type="fixed" summary="ray-direction local x coordinate"/>
      <arg name="ray_direction_y" type="fixed" summary="ray-direction local y coordinate"/>
      <arg name="ray_direction_z" type="fixed" summary="ray-direction local z coordinate"/>
    </event>

    <event name="leave">
      <description summary="leave event">TBD</description>
      <arg name="serial" type="uint" summary="serial number of the leave event"/>
      <arg name="cuboid_window" type="object" interface="z11_cuboid_window"/>
    </event>

    <event name="motion">
      <description summary="motion event">TBD</description>
      <arg name="time" type="uint" summary="timestamp with millisecond granularity"/>
      <arg name="ray_origin_x" type="fixed" summary="ray-origin local x coordinate"/>
      <arg name="ray_origin_y" type="fixed" summary="ray-origin local y coordinate"/>
      <arg name="ray_origin_z" type="fixed" summary="ray-origin local z coordinate"/>
      <arg name="ray_direction_x" type="fixed" summary="ray-direction local x coordinate"/>
      <arg name="ray_direction_y" type="fixed" summary="ray-direction local y coordinate"/>
      <arg name="ray_direction_z" type="fixed" summary="ray-direction local z coordinate"/>
    </event>

    <enum name="button_state">
      <description summary="physical button state">TBD</description>
      <entry name="released" value="0" summary="the button is not pressed" />
      <entry name="pressed" value="1" summary="the button is pressed" />
    </enum>

    <event name="button">
      <description summary="button event">
        The button is a button code as defined in the Linux kernel's
        linux/input-event-codes.h header file, e.g. BTN_LEFT.
      </description>
      <arg name="serial" type="uint" summary="serial number of the button event"/>
      <arg name="time" type="uint" summary="timestamp with millisecond granularity"/>
      <arg name="button" type="uint" summary="button that produced the event"/>
      <arg name="state" type="uint" enum="button_state" summary="physical state of the button"/>
    </event>

    <request name="release" type="destructor">
      <description summary="release the ray object">TBD</description>
    </request>
  </interface>

  <interface name="z11_keyboard" version="1">
    <description summary="keyboard input device">TBD</description>

    <enum name="keymap_format">
      <description summary="keyboard mapping format">
	      This specifies the format of the keymap provided to the
	      client with the z11_keyboard.keymap event.
      </description>
      <entry name="no_keymap" value="0"
	     summary="no keymap; client must understand how to interpret the raw keycode"/>
      <entry name="xkb_v1" value="1"
	     summary="libxkbcommon compatible; to determine the xkb keycode, clients must add 8 to the key event keycode"/>
    </enum>

    <event name="keymap">
      <description summary="keyboard mapping">
	      This event provides a file descriptor to the client which can be
	      memory-mapped in read-only mode to provide a keyboard mapping
	      description.

	      From version 7 onwards, the fd must be mapped with MAP_PRIVATE by
	      the recipient, as MAP_SHARED may fail.
      </description>
      <arg name="format" type="uint" enum="keymap_format" summary="keymap format"/>
      <arg name="fd" type="fd" summary="keymap file descriptor"/>
      <arg name="size" type="uint" summary="keymap size, in bytes"/>
    </event>

    <event name="enter">
      <description summary="enter event">TBD</description>
      <arg name="serial" type="uint" summary="serial number of the enter event"/>
      <arg name="cuboid_window" type="object" interface="z11_cuboid_window"/>
      <arg name="keys" type="array" summary="the currently pressed keys"/>
    </event>

    <event name="leave">
      <description summary="leave event">TBD</description>
      <arg name="serial" type="uint" summary="serial number of the leave event"/>
      <arg name="cuboid_window" type="object" interface="z11_cuboid_window"/>
    </event>

    <enum name="key_state">
      <description summary="physical key state">
        Describes the physical state of a key that produced the key event.
      </description>
      <entry name="released" value="0" summary="key is not pressed"/>
      <entry name="pressed" value="1" summary="key is pressed"/>
    </enum>

    <event name="key">
      <description summary="key event">
        A key was pressed or released.
        The time argument is a timestamp with millisecond
        granularity, with an undefined base.

        The key is a platform-specific key code that can be interpreted
        by feeding it to the keyboard mapping (see the keymap event).

        If this event produces a change in modifiers, then the resulting
        z11_keyboard.modifiers event must be sent after this event.
      </description>
      <arg name="serial" type="uint" summary="serial number of the key event"/>
      <arg name="time" type="uint" summary="timestamp with millisecond granularity"/>
      <arg name="key" type="uint" summary="key that produced the event"/>
      <arg name="state" type="uint" enum="key_state" summary="physical state of the key"/>
    </event>

    <event name="modifiers">
      <description summary="modifier and group state">
        Notifies clients that the modifier and/or group state has
        changed, and it should update its local state.
      </description>
      <arg name="serial" type="uint" summary="serial number of the modifiers event"/>
      <arg name="mods_depressed" type="uint" summary="depressed modifiers"/>
      <arg name="mods_latched" type="uint" summary="latched modifiers"/>
      <arg name="mods_locked" type="uint" summary="locked modifiers"/>
      <arg name="group" type="uint" summary="keyboard layout"/>
    </event>

    <request name="release" type="destructor">
      <description summary="release the keyboard object"/>
    </request>
  </interface>

  <interface name="z11_shell" version="1">
    <description summary="z11 shell">TBD</description>

    <request name="get_cuboid_window">
      <description summary="get cuboid window">You cannot create cuboid window more than one for each virutal object.</description>
      <arg name="id" type="new_id" interface="z11_cuboid_window" summary="cuboid window to create"/>
      <arg name="virtual_object" type="object" interface="z11_virtual_object"/>
    </request>
  </interface>

  <interface name="z11_cuboid_window" version="1">
    <description summary="https://github.com/gray-armor/z11/wiki/interface:z11_cuboid_window"/>
    <request name="destroy" type="destructor">
      <description summary="destroy cuboid window">TBD</description>
    </request>

    <request name="request_window_size">
      <description summary="https://github.com/gray-armor/z11/wiki/interface:z11_cuboid_window#request_window_resize"/>
      <arg name="width" type="fixed"/>
      <arg name="height" type="fixed"/>
      <arg name="depth" type="fixed"/>
    </request>

    <event name="configure">
      <description summary="https://github.com/gray-armor/z11/wiki/interface:z11_cuboid_window#configure"/>
      <arg name="width" type="fixed"/>
      <arg name="height" type="fixed"/>
      <arg name="depth" type="fixed"/>
    </event>

    <request name="move">
      <description summary="https://github.com/gray-armor/z11/wiki/interface:z11_cuboid_window#move"/>
      <arg name="seat" type="object" interface="z11_seat" summary="the z11_seat of the user event"/>
      <arg name="serial" type="uint" summary="the serial of the user event"/>
    </request>
  </interface>

  <interface name="z11_data_offer" version="1">
    <description summary="offer to transfer data">TBD</description>

    <request name="accept">
      <description summary="accept one of the offered mime types">TBD</description>
      <arg name="serial" type="uint" summary="serial number of the accept request"/>
      <arg name="mime_type" type="string" allow-null="true" summary="mime type offered by the data source"/>
    </request>

    <request name="receive">
      <description summary="request that the data if transferred">TBD</description>
      <arg name="mime_type" type="string" summary="mime type desired by receiver"/>
      <arg name="fd" type="fd" summary="file descriptor for data transfer"/>
    </request>

    <request name="finish">
      <description summary="the offer will no longer be used">TBD</description>
    </request>

    <request name="set_actions">
      <description summary="set the available/preferred drag-and-drop actions">TBD</description>
      <arg name="dnd_actions" type="uint" summary="actions supported by the destination client" enum="z11_data_device_manager.dnd_action"/>
      <arg name="preferred_action" type="uint" summary="actions preferred by the destination client" enum="z11_data_device_manager.dnd_action"/>
    </request>

    <request name="destroy" type="destructor">
      <description summary="destroy data offer">TBD</description>
    </request>

    <event name="offer">
      <description summary="advertise offered mime type">TBD</description>
      <arg name="mime_type" type="string" summary="offered mime type"/>
    </event>

    <event name="source_actions">
      <description summary="notify the source-side available actions">TBD</description>
      <arg name="source_actions_action" type="uint" summary="action offered by the data source" enum="z11_data_device_manager.dnd_action"/>
    </event>

    <event name="action">
      <description summary="notify the selected action">TBD</description>
      <arg name="dnd_action" type="uint" summary="action selected by the compositor" enum="z11_data_device_manager.dnd_action"/>
    </event>
  </interface>

  <interface name="z11_data_source" version="1">
    <description summary="offer to transfer data">TBD</description>

    <request name="offer">
      <description summary="add an offered mime type">TBD</description>
      <arg name="mime_type" type="string" summary="mime type offered by the data source"/>
    </request>

    <request name="set_actions">
      <description summary="set the available drag-and-drop actions">TBD</description>
      <arg name="dnd_actions" type="uint" summary="actions supported by the data source" enum="z11_data_device_manager.dnd_action"/>
    </request>

    <request name="destroy" type="destructor">
      <description summary="destroy the data source">TBD</description>
    </request>

    <event name="target">
      <description summary="a target accepts an offered mime type">TBD</description>
      <arg name="mime_type" type="string" allow-null="true" summary="mime type accepted by the target"/>
    </event>

    <event name="send">
      <description summary="send the data">TBD</description>
      <arg name="mime_type" type="string" summary="mime type for the data"/>
      <arg name="fd" type="fd" summary="file descriptor for the data"/>
    </event>

    <event name="cancelled">
      <description summary="selection was cancelled">TBD</description>
    </event>

    <event name="dnd_drop_performed">
      <description summary="the drag-and-drop operation physically finished">TBD</description>
    </event>

    <event name="dnd_finished">
      <description summary="the drag-and-drop operation concluded">TBD</description>
    </event>

    <event name="action">
      <description summary="notify the selected action">TBD</description>
      <arg name="dnd_action" type="uint" summary="action selected by the compositor" enum="z11_data_device_manager.dnd_action"/>
    </event>
  </interface>

  <interface name="z11_data_device" version="1">
    <description summary="data transfer device">TBD</description>

    <request name="start_drag">
      <description summary="start drag-and-drop operation">TBD</description>
      <arg name="source" type="object" interface="z11_data_source" allow-null="true" summary="data source for the eventual transfer"/>
      <arg name="origin" type="object" interface="z11_virtual_object" summary="surface where the drag originates"/>
      <arg name="icon" type="object" interface="z11_virtual_object" allow-null="true" summary="drag-and-drop icon surface"/>
      <arg name="serial" type="uint" summary="serial number of the implicit grab on the origin"/>
    </request>

    <request name="release" type="destructor">
      <description summary="destroy data device">TBD</description>
    </request>

    <event name="data_offer">
      <description summary="introduce a new z11_data_offer">TBD</description>
      <arg name="id" type="new_id" interface="z11_data_offer" summary="the new data_offer object"/>
    </event>

    <event name="enter">
      <description summary="initiate drag-and-drop session">TBD</description>
      <arg name="serial" type="uint" summary="serial number of the enter event"/>
      <arg name="cuboid_window" type="object" interface="z11_cuboid_window"/>
      <arg name="ray_origin_x" type="fixed" summary="ray-origin local x coordinate"/>
      <arg name="ray_origin_y" type="fixed" summary="ray-origin local y coordinate"/>
      <arg name="ray_origin_z" type="fixed" summary="ray-origin local z coordinate"/>
      <arg name="ray_direction_x" type="fixed" summary="ray-direction local x coordinate"/>
      <arg name="ray_direction_y" type="fixed" summary="ray-direction local y coordinate"/>
      <arg name="ray_direction_z" type="fixed" summary="ray-direction local z coordinate"/>
      <arg name="id" type="object" interface="z11_data_offer" allow-null="true" summary="source data_offer object"/>
    </event>

    <event name="leave">
      <description summary="end drag-and-drop session">TBD</description>
    </event>

    <event name="motion">
      <description summary="drag-and-drop session motion">TBD</description>
      <arg name="time" type="uint" summary="timestamp with millisecond granularity"/>
      <arg name="ray_origin_x" type="fixed" summary="ray-origin local x coordinate"/>
      <arg name="ray_origin_y" type="fixed" summary="ray-origin local y coordinate"/>
      <arg name="ray_origin_z" type="fixed" summary="ray-origin local z coordinate"/>
      <arg name="ray_direction_x" type="fixed" summary="ray-direction local x coordinate"/>
      <arg name="ray_direction_y" type="fixed" summary="ray-direction local y coordinate"/>
      <arg name="ray_direction_z" type="fixed" summary="ray-direction local z coordinate"/>
    </event>

    <event name="drop">
      <description summary="end drag-and-drop session successfully">TBD</description>
    </event>
  </interface>

  <interface name="z11_data_device_manager" version="1">
    <description summary="data transfer interface">TBD</description>

    <request name="create_data_source">
      <description summary="create a new data source"/>
      <arg name="id" type="new_id" interface="z11_data_source" summary="data source to create"/>
    </request>

    <request name="get_data_device">
      <arg name="id" type="new_id" interface="z11_data_device" summary="data device to create"/>
      <arg name="seat" type="object" interface="z11_seat" summary="seat associated with the data device"/>
    </request>

    <enum name="dnd_action" bitfield="true" >
      <description summary="drag and drop actions">TBD</description>
      <entry name="none" value="0" summary="no action"/>
      <entry name="copy" value="1" summary="copy action"/>
      <entry name="move" value="2" summary="move action"/>
      <entry name="ask" value="4" summary="ask action"/>
    </enum>
  </interface>
</protocol>
